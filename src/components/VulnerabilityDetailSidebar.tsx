import { IVulnerabilityType } from "@/types/vulnerability";
import { useRef } from "react";
import { Button } from "react-bootstrap";
import VulnerabilityDetailContent from "./VulnerabilityDetailContent";

interface VulnerabilityDetailSidebarProps {
  vulnerability: IVulnerabilityType | null;
  isOpen: boolean;
  onClose: () => void;
}

const severityVariants = {
  CRITICAL: "danger",
  HIGH: "warning",
  MEDIUM: "info",
  LOW: "success"
} as const;

const statusVariants = {
  ACTIVE: "danger",
  RESOLVED: "success",
  MITIGATED: "primary"
} as const;

export default function VulnerabilityDetailSidebar({
  vulnerability,
  isOpen,
  onClose
}: VulnerabilityDetailSidebarProps) {
  const sidebarContentRef = useRef<HTMLDivElement>(null);

  if (!vulnerability) return null;

  const formatCVSSScore = (cvss: any) => {
    if (!cvss) return null;
    return {
      score: cvss.score || cvss.cvss_v3?.score,
      vector: cvss.vector_string || cvss.cvss_v3?.vector_string
    };
  };

  if (!isOpen) {
    return null;
  }

  return (
    <>
      <div className={`vulnerability-sidebar ${isOpen ? "open" : ""}`}>
        <div className='sidebar-content' ref={sidebarContentRef}>
          {/* Header */}
          <div className='sidebar-header d-flex justify-content-between align-items-center mb-3'>
            <h5 className='mb-0 fw-bold'>Vulnerability Details</h5>
            <Button
              variant='outline-secondary'
              size='sm'
              onClick={onClose}
              className='p-1'
              aria-label='Close vulnerability details sidebar'
            >
              <i className='bi bi-x-lg'></i>
            </Button>
          </div>

          <VulnerabilityDetailContent vulnerability={vulnerability} />
        </div>
      </div>
      <div
        className={`sidebar-overlay ${isOpen ? "show" : ""}`}
        onClick={onClose}
        aria-hidden='true'
        role='button'
        tabIndex={-1}
      ></div>
    </>
  );
}
